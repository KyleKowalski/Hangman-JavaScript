<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">

  <title>Hangman</title>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body>

  	<script type="text/javascript">
  		// obvious variable is obvious - used for 'teaching' myself... and others.
  		var debugging = false;
  		var verbose = false;

  		if (debugging) {console.log("----- Start Game -----");}
  		// TODO find a way to limit variable scope

  		var wordArray = [
  			"Kashyyyk",	
			"Obi-wan Kenobi",
			"Darth Vader",
			"Darth Sidious",
			"General Grievous",
			"The Clone Wars",
			"Leia Organa Solo",
			"Come to the dark side... we have cookies!",
			"Jedi"
			]

		if (debugging) {console.log(wordArray);}

		var randomNumber = Math.floor(Math.random() * wordArray.length);
		var thisWord = wordArray[randomNumber];
		console.log ("Our random number: " + randomNumber + " so word is: " + thisWord);

	    // split it into an array for use later
	    // TODO make this more complex for use with sentences
	    	// would require handling of spaces or dashes
	    var thisWordArray = thisWord.split("");

	    if (debugging) {console.log("For this game we'll use: " + thisWordArray);}

	    var previousGuessesArray = []; // clear out and setup the guess array
	    var maxIncorrectGuesses = 7; // TODO make this a user variable easy/medium/hard ?
	    var incorrectGuesses = 0;
	    var keyPressed = "";

		document.onkeyup = function(event) {

			if (debugging) {console.log("----- Start of Guess -----");}
			// read the entry from the user - lower case to simplify handling of capital letters
			var keyPressed = event.key.toLowerCase();

			// see if the guess is a valid letter
			// if it is, check the current array to see if it has been guessed
			if (isValidLetterToGuess(keyPressed))
			{
				if (debugging) {console.log("Looks like we had a good letter >" + keyPressed + "< - moving on");}
				checkGuessArrayAddIfMissing(keyPressed);

				var correctGuessesArray = viewGuessedWord();

				// check to see if won/lost -- win first as one can win on their last guess
				if (checkForWin())
				{
					console.log(correctGuessesArray);
					console.log("You won!  Congratulations!");

					// TODO something to end the game and restart

					if (debugging) {console.log("----- End Game -----");}
				}
				else if(checkForLoss())
				{
					console.log("Game Over. wah waaa");

					// TODO something to end the game and restart

					if (debugging) {console.log("----- End Game -----");}
				}
				else
				{
					// if not won/lost - refresh the guess stats
					// show letters guessed & show guess count remaining
					console.log("Guessed letters: >" + previousGuessesArray + "< Remaining: " + (maxIncorrectGuesses - incorrectGuesses));
					// show current word in a semi-guessed state
					console.log(correctGuessesArray);
				}
			}

			if (debugging) {console.log("----- End of Guess -----");}
		};

		function isValidLetterToGuess (keyPressed) {
			if (event.keyCode >= 65 && event.keyCode <= 90) // gives us our alphabet
			{
	    		if (debugging) {console.log("Valid letter:  " + keyPressed);}
	    		return true;
			}
		}

		function checkGuessArrayAddIfMissing(keyPressed) {
			if (previousGuessesArray.indexOf(keyPressed) > -1) 
			{
				if (debugging) {console.log("This letter previously guessed: " + keyPressed);}
			}
			else
			{
				if (debugging) {console.log("NOT previously guessed, adding: " + keyPressed);}
				// add new guess to the array
				previousGuessesArray.push(keyPressed);
				// see if the guess should count against the player
				wasThisAGoodGuessOrDoYouHangMore(keyPressed);
			}
		}

		function checkForWin() {
			var weWon = true;
			var correctGuessesArray = viewGuessedWord();

			if (correctGuessesArray.indexOf("_") > -1) {
					console.log()
					weWon = false;
			}
			return weWon;
		}

		function checkForLoss() {
			var guessesLeft = maxIncorrectGuesses - incorrectGuesses;
			if (guessesLeft == 0)
			{
				if (debugging) {console.log("You lost, please try again! " + guessesLeft + " guesses remain.");}
				return true;
			}
			else
			{
				return false;
			}
		}

		function viewGuessedWord() {
			// setup to return this item at the end
			var returnWordArray = [];

			for (var i = 0; i < thisWordArray.length; i++) {

				// if it's dash or underscore, just pass it through
				if (thisWordArray[i] === " " 
					|| thisWordArray[i] === "-" 
					|| thisWordArray[i] === "."
					|| thisWordArray[i] === "!") {
					returnWordArray.push(thisWordArray[i])
				}
				// if it is part of the guessed letters - show the letter
				else if (previousGuessesArray.indexOf(thisWordArray[i].toLowerCase()) > -1) {
					returnWordArray.push(thisWordArray[i])
				}
				// if it is not guessed, send back an underscore or "blank" character
				else {
					returnWordArray.push("_");
				}
				if (verbose) {console.log("Building to return: >" + returnWordArray + "<");}
			}
			if (debugging) {console.log("Finished, returning: >" + returnWordArray + "<");}
			return returnWordArray;
		}

		function wasThisAGoodGuessOrDoYouHangMore(keyPressed) {
			// if our key entered by the user is either upper or lower case it's a good guess, if it's NEITHER, it's incorrect
			if ((thisWordArray.indexOf(keyPressed) || thisWordArray.indexOf(keyPressed.toUpperCase())) !== -1) {
				if (debugging) {console.log("Good guess!");}
			}
			else {
				if (debugging) {console.log("Incorrect Guess! >" + keyPressed + "<");}
				incorrectGuesses++;
			}
			if (debugging) {console.log("Bad guesses so far: " + incorrectGuesses);}
		}
	</script>
</body>
</html>